<form [formGroup]="parent" class="form">
  <div class="email-addresses" formArrayName="emailAddresses">
    <mat-form-field
      appearance="outline"
      class="form-field"
      *ngFor="let address of emailAddressesArray.controls; let i = index"
      [formGroupName]="i"
    >
      <mat-label>Email Address*</mat-label>
      <input
        matInput
        placeholder="Email Recipient(s)"
        formControlName="emailAddress"
      />
      <button
        matSuffix
        mat-icon-button
        *ngIf="i > 0"
        (click)="removeEmailAddress.emit(i)"
      >
        <mat-icon color="primary">close</mat-icon>
      </button>
      <mat-hint *ngIf="i < 1" align="end">
        *At least one email address is required
      </mat-hint>
      <mat-error *ngIf="invalidBet365Email(i)">
        {{ validationMessages['emailAddresses']['validBet365Email'] }}
      </mat-error>
    </mat-form-field>
  </div>

  <div class="add-email-address">
    <hydro-button-raised
      color="primary"
      (click)="addEmailAddress.emit()"
      [disabled]="parent.get('emailAddresses').invalid"
    >
      Add Another Email Address
    </hydro-button-raised>
  </div>

  <mat-form-field appearance="outline" class="form-field">
    <mat-label>Email Subject*</mat-label>
    <input
      matInput
      placeholder="Email Subject"
      formControlName="emailSubject"
    />
    <mat-hint align="end">
      *Required
    </mat-hint>
    <mat-error *ngIf="parent.get('emailSubject').hasError('required')">
      {{ validationMessages['emailSubject']['required'] }}
    </mat-error>
  </mat-form-field>

  <div *ngIf="actionType === 'emailRate'" class="email-rate">
    <mat-form-field appearance="outline">
      <mat-label>Email Send Limit</mat-label>
      <input
        type="number"
        min="-1"
        matInput
        placeholder="Email Send Limit"
        formControlName="emailSendLimit"
      />
    </mat-form-field>
    <p class="email-rate-explanation">
      The maximum number of emails to send out in any single hour, this resets
      after every hour. Use -1 to specify an unlimited number of emails per hour
    </p>
  </div>

  <mat-form-field
    appearance="outline"
    class="form-field"
    *ngIf="actionType === 'emailAlert'"
  >
    <mat-label>Parameters*</mat-label>
    <mat-select placeholder="Parameters*" multiple>
      <mat-option
        *ngFor="let parameter of availableParameters"
        [value]="parameter"
      >
        {{ parameter }}
      </mat-option>
    </mat-select>
  </mat-form-field>

  <div class="email-text">
    <h3 class="email-text-title">Email Text</h3>
    <p class="email-text-explanation">
      This text can contain variable data, using the
      <b class="code">${{ '{' }}data{{ '}' }}</b> substitution tag, where
      <b class="code">data</b> can be any esper data field, such as
      <b class="code">${{ '{' }}uname{{ '}' }}</b
      >, <b class="code">${{ '{' }}topic{{ '}' }}</b> or
      <b class="code">${{ '{' }}sip{{ '}' }}</b
      >. To display the esperdata there MUST be a
      <b class="code">${{ '{' }}esperdata{{ '}' }}</b> substitution tag.
    </p>
    <mat-error
      *ngIf="parent.get('emailText').hasError('required')"
      class="email-text-error"
    >
      {{ validationMessages['emailText']['required'] }}
    </mat-error>
    <div class="email-editor">
      <quill (contentChange)="onContentChange($event)"> </quill>
    </div>
  </div>
</form>
