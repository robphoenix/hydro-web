<div *ngIf="dataSource.data && dataSource.data.length">
  <div class="flex items-center mb4">
    <mat-button-toggle-group
      [(value)]="monitorsType"
      (change)="changeMonitorsType.emit($event.value)"
    >
      <mat-button-toggle value="standard">
        <span class="mid-gray fw5"> Standard </span>
      </mat-button-toggle>
      <mat-button-toggle value="archived">
        <span class="mid-gray fw5"> Archived </span>
      </mat-button-toggle>
      <mat-button-toggle value="system">
        <span class="mid-gray fw5"> System </span>
      </mat-button-toggle>
    </mat-button-toggle-group>

    <mat-button-toggle-group
      class="status-toggle"
      [value]="monitorsStatus"
      (change)="toggleStatus($event.value)"
      [disabled]="!canToggleStatus"
    >
      <mat-button-toggle value="online" class="button-toggle">
        <mat-icon class="online" matTooltip="Online">flash_on</mat-icon>
      </mat-button-toggle>
      <mat-button-toggle value="offline">
        <mat-icon class="offline" matTooltip="Offline">flash_off</mat-icon>
      </mat-button-toggle>
      <mat-button-toggle value="all">
        <mat-icon class="all-monitors" matTooltip="All Monitors"
          >flash_on</mat-icon
        >
      </mat-button-toggle>
    </mat-button-toggle-group>

    <app-search-input
      class="search"
      [(searchTerm)]="filterValues.searchTerm"
      [placeHolder]="'Search Monitors'"
      (searchTermChange)="filterMonitors()"
    ></app-search-input>

    <!-- <app-primary-button
      [icon]="'cached'"
      class="refresh"
      (click)="refresh.emit()"
    >
      Refresh
    </app-primary-button> -->

    <app-primary-button
      class="clear-filters"
      *ngIf="hasActions() || allCurrentCategories.length"
      [disabled]="hasFilters()"
      [icon]="'clear_all'"
      (click)="clearAllFilters()"
    >
      Clear Filters
    </app-primary-button>

    <app-accent-button
      class="add-monitor"
      (click)="router.navigateByUrl('/monitors/add')"
      [icon]="'add'"
    >
      New Monitor
    </app-accent-button>
  </div>

  <div class="table-outer-wrapper">
    <div class="table-inner-wrapper">
      <mat-table
        [dataSource]="dataSource"
        matSort
        (matSortChange)="sortData($event)"
      >
        <ng-container matColumnDef="monitor">
          <mat-header-cell *matHeaderCellDef mat-sort-header>
            <h2 class="f4 fw4 near-black ml4">
              Monitor
            </h2>
          </mat-header-cell>
          <mat-cell *matCellDef="let monitor" class="mat-monitor-cell">
            <app-cell-monitor
              [monitor]="monitor"
              class="monitor-cell"
              (viewEplQuery)="viewEplQuery($event)"
            ></app-cell-monitor>
          </mat-cell>
        </ng-container>

        <ng-container matColumnDef="actions">
          <mat-header-cell *matHeaderCellDef class="actions">
            <h2 class="f4 fw4 near-black mr2">Actions</h2>
            <button
              mat-stroked-button
              *ngIf="hasActions()"
              [matMenuTriggerFor]="actionsMenu"
            >
              Filter
            </button>
            <mat-menu #actionsMenu="matMenu">
              <button
                mat-menu-item
                *ngIf="hasActions('block')"
                [matMenuTriggerFor]="block"
              >
                <mat-icon>block</mat-icon>
                <span>Block</span>
              </button>
              <mat-menu #block="matMenu">
                <app-multiple-select
                  [formControl]="blockControl"
                  [placeHolder]="'Filter Block Actions'"
                  [options]="allCurrentActions['block']"
                  [(selectedOptions)]="filterValues.selectedActions['block']"
                  (selectedOptionsChange)="filterMonitors()"
                  ngDefaultControl
                ></app-multiple-select>
              </mat-menu>

              <button
                mat-menu-item
                *ngIf="hasActions('email')"
                [matMenuTriggerFor]="email"
              >
                <mat-icon>email</mat-icon>
                <span>Email</span>
              </button>
              <mat-menu #email="matMenu">
                <app-multiple-select
                  [formControl]="emailControl"
                  [placeHolder]="'Filter Email Actions'"
                  [options]="allCurrentActions['email']"
                  [(selectedOptions)]="filterValues.selectedActions['email']"
                  (selectedOptionsChange)="filterMonitors()"
                  ngDefaultControl
                ></app-multiple-select>
              </mat-menu>

              <button
                mat-menu-item
                *ngIf="hasActions('store')"
                [matMenuTriggerFor]="store"
              >
                <mat-icon>check</mat-icon>
                <span>Store</span>
              </button>
              <mat-menu #store="matMenu">
                <app-multiple-select
                  [formControl]="storeControl"
                  [placeHolder]="'Filter Store Actions'"
                  [options]="allCurrentActions['store']"
                  [(selectedOptions)]="filterValues.selectedActions['store']"
                  (selectedOptionsChange)="filterMonitors()"
                  ngDefaultControl
                ></app-multiple-select>
              </mat-menu>

              <button
                mat-menu-item
                *ngIf="hasActions('other')"
                [matMenuTriggerFor]="other"
              >
                <mat-icon>subject</mat-icon>
                <span>Other</span>
              </button>
              <mat-menu #other="matMenu">
                <app-multiple-select
                  [formControl]="otherControl"
                  [placeHolder]="'Filter Other Actions'"
                  [options]="allCurrentActions['other']"
                  [(selectedOptions)]="filterValues.selectedActions['other']"
                  (selectedOptionsChange)="filterMonitors()"
                  ngDefaultControl
                ></app-multiple-select>
              </mat-menu>
            </mat-menu>
          </mat-header-cell>
          <mat-cell *matCellDef="let monitor" class="actions">
            <app-cell-actions [actions]="monitor.actions"></app-cell-actions>
          </mat-cell>
        </ng-container>

        <ng-container matColumnDef="categories">
          <mat-header-cell *matHeaderCellDef class="categories">
            <h2 class="f4 fw4 near-black mr2">
              Categories
            </h2>
            <button
              *ngIf="allCurrentCategories.length"
              mat-stroked-button
              [matMenuTriggerFor]="categoriesMenu"
            >
              Filter
            </button>
            <mat-menu #categoriesMenu="matMenu">
              <app-multiple-select
                [formControl]="categoriesControl"
                [placeHolder]="'Filter Categories'"
                [options]="allCurrentCategories"
                [(selectedOptions)]="filterValues.selectedCategories"
                (selectedOptionsChange)="filterMonitors()"
                ngDefaultControl
              ></app-multiple-select>
            </mat-menu>
          </mat-header-cell>
          <mat-cell *matCellDef="let monitor" class="categories">
            <app-cell-categories
              [categories]="monitor.categories"
            ></app-cell-categories>
          </mat-cell>
        </ng-container>

        <ng-container matColumnDef="menu">
          <mat-header-cell *matHeaderCellDef class="menu"> </mat-header-cell>
          <mat-cell *matCellDef="let monitor" class="menu">
            <app-cell-menu
              [status]="monitor.status"
              [id]="monitor.id"
              (archiveMonitor)="archiveMonitor($event)"
              (unArchiveMonitor)="unArchiveMonitor($event)"
              (enableMonitor)="enableMonitor($event)"
              (disableMonitor)="disableMonitor($event)"
            ></app-cell-menu>
          </mat-cell>
        </ng-container>

        <mat-header-row
          *matHeaderRowDef="displayedColumns; sticky: true"
        ></mat-header-row>
        <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
      </mat-table>
    </div>

    <mat-paginator
      class="paginator"
      #paginator
      [length]="monitors.length"
      [pageSize]="10"
      [pageSizeOptions]="[5, 10, 25]"
      showFirstLastButtons
    ></mat-paginator>
  </div>
</div>
