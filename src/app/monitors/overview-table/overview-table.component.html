<div class="toolbar">
  <mat-button-toggle-group
    [(value)]="monitorsType"
    (change)="changeMonitorsType.emit($event.value)"
  >
    <mat-button-toggle value="standard">
      <mat-icon class="primary icon">flash_on</mat-icon>
      <span class="primary"> Standard </span>
    </mat-button-toggle>
    <mat-button-toggle value="archived">
      <mat-icon class="primary icon">archive</mat-icon>
      <span class="primary"> Archived </span>
    </mat-button-toggle>
    <mat-button-toggle value="system">
      <mat-icon class="primary icon">tune</mat-icon>
      <span class="primary"> System </span>
    </mat-button-toggle>
  </mat-button-toggle-group>

  <mat-button-toggle-group
    class="status-toggle"
    [value]="monitorsStatus"
    (change)="toggleStatus($event.value)"
    [disabled]="!canToggleStatus"
  >
    <mat-button-toggle value="online" class="button-toggle">
      <mat-icon class="online" matTooltip="Online">flash_on</mat-icon>
    </mat-button-toggle>
    <mat-button-toggle value="offline">
      <mat-icon class="offline" matTooltip="Offline">flash_off</mat-icon>
    </mat-button-toggle>
    <mat-button-toggle value="all">
      <mat-icon class="all-monitors" matTooltip="All Monitors"
        >flash_on</mat-icon
      >
    </mat-button-toggle>
  </mat-button-toggle-group>

  <app-search-input
    class="search"
    [(searchTerm)]="filterValues.searchTerm"
    [placeHolder]="'Search Monitors'"
    (searchTermChange)="filterMonitors()"
  ></app-search-input>

  <app-primary-button
    *ngIf="hasActions() || allCurrentCategories.length"
    [disabled]="hasFilters()"
    [icon]="'clear_all'"
    (click)="clearAllFilters()"
  >
    clear filters
  </app-primary-button>

  <app-accent-button
    mat-flat-button
    class="new-monitor-button"
    routerLink="'/monitors/add'"
    [icon]="'add'"
  >
    New Monitor
  </app-accent-button>
</div>

<div class="overview-table">
  <div class="table">
    <mat-table
      [dataSource]="dataSource"
      matSort
      matSortActive="name"
      matSortDirection="asc"
      matSortDisableClear
    >
      <ng-container matColumnDef="monitor">
        <mat-header-cell *matHeaderCellDef mat-sort-header>
          <app-icon [type]="'monitor'"></app-icon>
          <p class="mat-h3 header-name">Monitor</p>
        </mat-header-cell>
        <mat-cell *matCellDef="let monitor">
          <app-cell-monitor
            [name]="monitor.name"
            [description]="monitor.description"
            [id]="monitor.id"
            [status]="monitor.status"
          ></app-cell-monitor>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="actions">
        <mat-header-cell *matHeaderCellDef class="actions">
          <app-icon [type]="'actions'"></app-icon>
          <p class="mat-h3 header-name">Actions</p>
          <button
            mat-icon-button
            *ngIf="hasActions()"
            [matMenuTriggerFor]="actionsMenu"
          >
            <mat-icon>filter_list</mat-icon>
          </button>
          <mat-menu #actionsMenu="matMenu">
            <button
              mat-menu-item
              *ngIf="hasActions('block')"
              [matMenuTriggerFor]="block"
            >
              <mat-icon>block</mat-icon>
              <span>Block</span>
            </button>
            <mat-menu #block="matMenu">
              <app-multiple-select
                [formControl]="blockControl"
                [placeHolder]="'Filter Block Actions'"
                [options]="allCurrentActions['block']"
                [(selectedOptions)]="filterValues.selectedActions.block"
                (selectedOptionsChange)="filterMonitors()"
                ngDefaultControl
              ></app-multiple-select>
            </mat-menu>

            <button
              mat-menu-item
              *ngIf="hasActions('email')"
              [matMenuTriggerFor]="email"
            >
              <mat-icon>email</mat-icon>
              <span>Email</span>
            </button>
            <mat-menu #email="matMenu">
              <app-multiple-select
                [formControl]="emailControl"
                [placeHolder]="'Filter Email Actions'"
                [options]="allCurrentActions['email']"
                [(selectedOptions)]="filterValues.selectedActions.email"
                (selectedOptionsChange)="filterMonitors()"
                ngDefaultControl
              ></app-multiple-select>
            </mat-menu>

            <button
              mat-menu-item
              *ngIf="hasActions('store')"
              [matMenuTriggerFor]="store"
            >
              <mat-icon>check</mat-icon>
              <span>Store</span>
            </button>
            <mat-menu #store="matMenu">
              <app-multiple-select
                [formControl]="storeControl"
                [placeHolder]="'Filter Store Actions'"
                [options]="allCurrentActions['store']"
                [(selectedOptions)]="filterValues.selectedActions.store"
                (selectedOptionsChange)="filterMonitors()"
                ngDefaultControl
              ></app-multiple-select>
            </mat-menu>

            <button
              mat-menu-item
              *ngIf="hasActions('other')"
              [matMenuTriggerFor]="other"
            >
              <mat-icon>subject</mat-icon>
              <span>Other</span>
            </button>
            <mat-menu #other="matMenu">
              <app-multiple-select
                [formControl]="otherControl"
                [placeHolder]="'Filter Other Actions'"
                [options]="allCurrentActions['other']"
                [(selectedOptions)]="filterValues.selectedActions.other"
                (selectedOptionsChange)="filterMonitors()"
                ngDefaultControl
              ></app-multiple-select>
            </mat-menu>
          </mat-menu>
        </mat-header-cell>
        <mat-cell *matCellDef="let monitor" class="actions">
          <app-cell-actions [actions]="monitor.actions"></app-cell-actions>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="categories">
        <mat-header-cell *matHeaderCellDef class="categories">
          <app-icon [type]="'categories'"></app-icon>
          <p class="mat-h3 header-name">Categories</p>
          <button
            *ngIf="allCurrentCategories.length"
            mat-icon-button
            [matMenuTriggerFor]="categoriesMenu"
          >
            <mat-icon>filter_list</mat-icon>
          </button>
          <mat-menu #categoriesMenu="matMenu">
            <app-multiple-select
              [formControl]="categoriesControl"
              [placeHolder]="'Filter Categories'"
              [options]="allCurrentCategories"
              [(selectedOptions)]="filterValues.selectedCategories"
              (selectedOptionsChange)="filterMonitors()"
              ngDefaultControl
            ></app-multiple-select>
          </mat-menu>
        </mat-header-cell>
        <mat-cell *matCellDef="let monitor" class="categories">
          <app-cell-categories
            [categories]="monitor.categories"
          ></app-cell-categories>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="menu">
        <mat-header-cell *matHeaderCellDef class="menu">
          <mat-icon class="menu-icon">more_vert</mat-icon>
          <p class="mat-h3 header-name">Menu</p>
        </mat-header-cell>
        <mat-cell *matCellDef="let monitor" class="menu">
          <app-cell-menu
            [status]="monitor.status"
            [id]="monitor.id"
            (archiveMonitor)="archiveMonitor($event)"
            (unArchiveMonitor)="unArchiveMonitor($event)"
            (enableMonitor)="enableMonitor($event)"
            (disableMonitor)="disableMonitor($event)"
            (viewEplQuery)="viewEplQuery($event)"
          ></app-cell-menu>
        </mat-cell>
      </ng-container>

      <mat-header-row
        *matHeaderRowDef="displayedColumns; sticky: true"
      ></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
    </mat-table>
  </div>

  <mat-paginator
    class="paginator"
    #paginator
    [length]="monitors.length"
    [pageSize]="10"
    [pageSizeOptions]="[5, 10, 25]"
    showFirstLastButtons
  ></mat-paginator>
</div>
